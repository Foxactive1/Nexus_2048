
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>2048 NEXUS â€” v2.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --c0: #050511;
      --c1: #0a0a20;
      --c2: #0f1030;
      --neon: #00f3ff;
      --neon2: #ff00ff;
      --green: #00ff9d;
      --warn: #ffcc00;
      --danger: #ff4d4d;
      --glass: rgba(255,255,255,0.04);
      --border: rgba(0,243,255,0.15);
      --radius: 16px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--c0);
      background-image:
        radial-gradient(ellipse at 15% 10%, rgba(0,243,255,0.07) 0%, transparent 40%),
        radial-gradient(ellipse at 85% 90%, rgba(255,0,255,0.07) 0%, transparent 40%),
        radial-gradient(ellipse at 50% 50%, rgba(0,255,157,0.03) 0%, transparent 60%);
      font-family: 'Rajdhani', sans-serif;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      touch-action: none;
    }

    canvas#particles {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .wrapper {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px 15px 40px;
      position: relative;
      z-index: 10;
    }

    /* â”€â”€â”€ HEADER â”€â”€â”€ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 18px;
      gap: 12px;
    }

    .logo-area h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.6rem;
      font-weight: 900;
      line-height: 1;
      background: linear-gradient(120deg, var(--neon) 0%, var(--neon2) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: none;
      letter-spacing: -1px;
    }

    .logo-area .ver {
      font-size: 0.75rem;
      letter-spacing: 4px;
      color: rgba(255,255,255,0.4);
      text-transform: uppercase;
      margin-top: 2px;
    }

    .stats-row {
      display: flex;
      gap: 10px;
    }

    .stat {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 14px;
      text-align: center;
      min-width: 80px;
      position: relative;
      overflow: hidden;
      transition: border-color 0.3s;
    }

    .stat::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(0,243,255,0.05), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .stat:hover { border-color: var(--neon); }
    .stat:hover::before { opacity: 1; }

    .stat-label {
      font-size: 0.72rem;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,0.45);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--neon);
      transition: color 0.3s;
    }

    .stat-value.pulse-up {
      animation: statPulse 0.4s ease-out;
    }

    @keyframes statPulse {
      0%   { transform: scale(1); color: var(--neon); }
      50%  { transform: scale(1.25); color: #fff; }
      100% { transform: scale(1); color: var(--neon); }
    }

    /* â”€â”€â”€ COMBO BANNER â”€â”€â”€ */
    #combo-banner {
      height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.85rem;
      letter-spacing: 2px;
      color: var(--warn);
      opacity: 0;
      transition: opacity 0.3s;
    }

    #combo-banner.show {
      opacity: 1;
      animation: comboPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes comboPop {
      0%   { transform: scale(0.7) translateY(10px); }
      100% { transform: scale(1) translateY(0); }
    }

    .combo-flame { animation: flameSpin 0.6s linear infinite alternate; }
    @keyframes flameSpin {
      from { transform: rotate(-8deg) scale(0.9); }
      to   { transform: rotate(8deg) scale(1.1); }
    }

    /* â”€â”€â”€ GRID SIZE + MODE SELECTORS â”€â”€â”€ */
    .selectors {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .sel-group {
      display: flex;
      gap: 6px;
    }

    .chip {
      background: rgba(10,10,40,0.6);
      border: 1px solid rgba(0,243,255,0.12);
      color: rgba(255,255,255,0.5);
      border-radius: 8px;
      padding: 7px 14px;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .chip:hover {
      border-color: rgba(0,243,255,0.3);
      color: rgba(255,255,255,0.8);
    }

    .chip.active {
      background: rgba(0,243,255,0.12);
      border-color: var(--neon);
      color: var(--neon);
      box-shadow: 0 0 10px rgba(0,243,255,0.2);
    }

    .chip.mode-time.active  { border-color: var(--warn); color: var(--warn); background: rgba(255,204,0,0.1); box-shadow: 0 0 10px rgba(255,204,0,0.2); }
    .chip.mode-extreme.active { border-color: var(--danger); color: var(--danger); background: rgba(255,77,77,0.1); box-shadow: 0 0 10px rgba(255,77,77,0.2); }
    .chip.mode-zen.active { border-color: var(--green); color: var(--green); background: rgba(0,255,157,0.08); box-shadow: 0 0 10px rgba(0,255,157,0.2); }

    /* â”€â”€â”€ TIMER â”€â”€â”€ */
    #timer-pill {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 18px;
      border-radius: 30px;
      margin-bottom: 14px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--warn), var(--danger));
      color: var(--c0);
      box-shadow: 0 0 20px rgba(255,204,0,0.3);
      animation: timerPulse 2s ease-in-out infinite;
    }

    #timer-pill.active { display: flex; }
    #timer-pill.urgent { background: linear-gradient(135deg, var(--danger), #ff0000); animation: timerPulse 0.5s ease-in-out infinite; }

    @keyframes timerPulse {
      0%,100% { box-shadow: 0 0 20px rgba(255,204,0,0.3); }
      50% { box-shadow: 0 0 35px rgba(255,204,0,0.6); }
    }

    /* â”€â”€â”€ BOARD â”€â”€â”€ */
    .board-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    #game-board {
      display: grid;
      gap: 10px;
      background: rgba(5,10,25,0.8);
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow:
        inset 0 0 30px rgba(0,243,255,0.06),
        0 15px 40px rgba(0,0,0,0.6),
        0 0 0 1px rgba(0,243,255,0.05);
      width: 100%;
      aspect-ratio: 1;
    }

    #game-board.board-4 { grid-template-columns: repeat(4, 1fr); }
    #game-board.board-5 { grid-template-columns: repeat(5, 1fr); }

    .tile {
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      border-radius: 10px;
      background: rgba(10,15,40,0.6);
      color: rgba(255,255,255,0.08);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
      aspect-ratio: 1;
      transition: transform 0.08s ease;
    }

    .tile.filled {
      animation: tileSpawn 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.6) forwards;
    }

    .tile.merged {
      animation: tileMerge 0.18s cubic-bezier(0.175, 0.885, 0.32, 1.6) forwards;
    }

    @keyframes tileSpawn {
      0%   { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes tileMerge {
      0%   { transform: scale(1); }
      40%  { transform: scale(1.25); }
      100% { transform: scale(1); }
    }

    /* Tile glow ripple on merge */
    .tile.merged::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: rgba(255,255,255,0.35);
      animation: mergeFlash 0.25s ease-out forwards;
    }

    @keyframes mergeFlash {
      from { opacity: 1; }
      to   { opacity: 0; }
    }

    /* TILE COLORS */
    .tile[data-v="2"]    { --tc: #a8d8ff; --bg1: #001d3380; --bg2: #003b6640; font-size: clamp(1rem, 4vw, 2rem); }
    .tile[data-v="4"]    { --tc: #7ec8ff; --bg1: #002b5080; --bg2: #005b9940; font-size: clamp(1rem, 4vw, 2rem); }
    .tile[data-v="8"]    { --tc: #55b8ff; --bg1: #003c7060; --bg2: #0077cc50; font-size: clamp(1rem, 4vw, 2rem); }
    .tile[data-v="16"]   { --tc: #00f3ff; --bg1: #004c9060; --bg2: #0099ee60; font-size: clamp(0.9rem, 3.8vw, 1.9rem); }
    .tile[data-v="32"]   { --tc: #ff80ff; --bg1: #4d006040; --bg2: #aa00cc60; font-size: clamp(0.9rem, 3.8vw, 1.9rem); }
    .tile[data-v="64"]   { --tc: #ff55ff; --bg1: #66007040; --bg2: #cc00ee70; font-size: clamp(0.85rem, 3.6vw, 1.8rem); }
    .tile[data-v="128"]  { --tc: #ff33dd; --bg1: #800060; --bg2: #cc00aa80; font-size: clamp(0.8rem, 3.4vw, 1.7rem); }
    .tile[data-v="256"]  { --tc: #ffcc55; --bg1: #554400; --bg2: #aa880080; font-size: clamp(0.75rem, 3.2vw, 1.6rem); }
    .tile[data-v="512"]  { --tc: #ffbb00; --bg1: #664400; --bg2: #cc880080; font-size: clamp(0.7rem, 3vw, 1.5rem); }
    .tile[data-v="1024"] { --tc: #66ffcc; --bg1: #005540; --bg2: #00aa8080; font-size: clamp(0.65rem, 2.8vw, 1.35rem); }
    .tile[data-v="2048"] { --tc: #00ffaa; --bg1: #007755; --bg2: #00ddaa90; font-size: clamp(0.6rem, 2.6vw, 1.25rem); }
    .tile[data-v="4096"] { --tc: #fff; --bg1: #330066; --bg2: #6600cc90; font-size: clamp(0.55rem, 2.4vw, 1.15rem); }
    .tile[data-v="8192"] { --tc: #fff; --bg1: #600; --bg2: #cc000090; font-size: clamp(0.5rem, 2.2vw, 1rem); }

    .tile[data-v] {
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--tc);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.1),
        0 4px 15px rgba(0,0,0,0.4),
        0 0 12px rgba(0,0,0,0.2);
      text-shadow: 0 0 8px currentColor;
    }

    .tile[data-v="2048"] {
      animation: winGlow 1.5s ease-in-out infinite alternate;
    }
    .tile[data-v="4096"] {
      animation: epicGlow 1s ease-in-out infinite alternate;
    }

    @keyframes winGlow {
      from { box-shadow: 0 0 15px rgba(0,255,170,0.4), inset 0 1px 0 rgba(255,255,255,0.1); }
      to   { box-shadow: 0 0 35px rgba(0,255,170,0.8), 0 0 60px rgba(0,255,170,0.3), inset 0 1px 0 rgba(255,255,255,0.2); }
    }

    @keyframes epicGlow {
      from { box-shadow: 0 0 20px rgba(150,0,255,0.5), inset 0 1px 0 rgba(255,255,255,0.1); }
      to   { box-shadow: 0 0 50px rgba(150,0,255,0.9), 0 0 80px rgba(150,0,255,0.4), inset 0 1px 0 rgba(255,255,255,0.3); }
    }

    /* Scan-line overlay on board */
    .board-wrapper::after {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,243,255,0.012) 2px,
        rgba(0,243,255,0.012) 4px
      );
      pointer-events: none;
      border-radius: var(--radius);
    }

    /* â”€â”€â”€ CONTROLS â”€â”€â”€ */
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 16px;
    }

    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 13px;
      border-radius: 12px;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.25s ease;
      border: 1px solid;
      background: transparent;
      color: #fff;
    }

    .btn-cyan {
      border-color: rgba(0,243,255,0.3);
      background: rgba(0,243,255,0.06);
    }
    .btn-cyan:hover:not(:disabled) {
      border-color: var(--neon);
      background: rgba(0,243,255,0.14);
      box-shadow: 0 0 20px rgba(0,243,255,0.3);
      transform: translateY(-2px);
    }

    .btn-magenta {
      border-color: rgba(255,0,255,0.3);
      background: rgba(255,0,255,0.06);
    }
    .btn-magenta:hover:not(:disabled) {
      border-color: var(--neon2);
      background: rgba(255,0,255,0.14);
      box-shadow: 0 0 20px rgba(255,0,255,0.3);
      transform: translateY(-2px);
    }

    .btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none !important; }

    /* â”€â”€â”€ PANELS â”€â”€â”€ */
    .panel {
      background: rgba(8,8,24,0.7);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      margin-bottom: 16px;
      backdrop-filter: blur(8px);
    }

    .panel-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--neon);
      letter-spacing: 3px;
      text-transform: uppercase;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* â”€â”€â”€ SESSION STATS â”€â”€â”€ */
    .session-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .ss-item {
      text-align: center;
      padding: 10px 6px;
      border-radius: 10px;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.05);
    }

    .ss-val {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--green);
      margin-bottom: 2px;
    }

    .ss-label {
      font-size: 0.72rem;
      color: rgba(255,255,255,0.4);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    /* â”€â”€â”€ ACHIEVEMENTS â”€â”€â”€ */
    .ach-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .ach-item {
      background: rgba(10,10,35,0.6);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 12px 6px;
      text-align: center;
      transition: all 0.35s ease;
    }

    .ach-item.unlocked {
      border-color: var(--warn);
      background: rgba(255,204,0,0.07);
      box-shadow: 0 0 12px rgba(255,204,0,0.2);
    }

    .ach-icon {
      font-size: 1.8rem;
      margin-bottom: 6px;
      filter: grayscale(1) opacity(0.3);
      transition: filter 0.4s;
    }

    .ach-item.unlocked .ach-icon { filter: grayscale(0) opacity(1); }

    .ach-name {
      font-size: 0.68rem;
      color: rgba(255,255,255,0.35);
      letter-spacing: 0.5px;
      line-height: 1.2;
      transition: color 0.4s;
    }

    .ach-item.unlocked .ach-name { color: var(--warn); }

    /* â”€â”€â”€ LEADERBOARD â”€â”€â”€ */
    .lb-list { display: flex; flex-direction: column; gap: 6px; }

    .lb-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 12px;
      border-radius: 10px;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.04);
      font-size: 0.9rem;
    }

    .lb-row:first-child { border-color: rgba(255,204,0,0.25); background: rgba(255,204,0,0.06); }

    .lb-rank {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.75rem;
      color: rgba(255,255,255,0.3);
      width: 20px;
      text-align: center;
    }

    .lb-row:first-child .lb-rank { color: var(--warn); }

    .lb-score {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      color: #fff;
      flex: 1;
    }

    .lb-meta { font-size: 0.75rem; color: rgba(255,255,255,0.3); }

    /* â”€â”€â”€ MODAL â”€â”€â”€ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(3,3,16,0.92);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 500;
      backdrop-filter: blur(12px);
    }

    .modal-overlay.show { display: flex; animation: modalFade 0.3s ease; }

    @keyframes modalFade {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .modal-box {
      background: linear-gradient(160deg, var(--c2) 0%, var(--c1) 100%);
      border: 1px solid rgba(0,243,255,0.3);
      border-radius: 20px;
      padding: 32px 28px;
      max-width: 360px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 40px rgba(0,243,255,0.15), 0 30px 60px rgba(0,0,0,0.7);
      animation: modalSlide 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes modalSlide {
      from { transform: scale(0.85) translateY(30px); opacity: 0; }
      to   { transform: scale(1) translateY(0); opacity: 1; }
    }

    .modal-icon { font-size: 3.5rem; margin-bottom: 12px; }

    .modal-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 8px;
    }

    .modal-title.win  { color: var(--green); text-shadow: 0 0 20px rgba(0,255,157,0.5); }
    .modal-title.lose { color: var(--danger); text-shadow: 0 0 20px rgba(255,77,77,0.4); }

    .modal-msg {
      color: rgba(255,255,255,0.65);
      font-size: 1rem;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .modal-score {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      color: #fff;
      margin-bottom: 6px;
    }

    .modal-score-label { font-size: 0.8rem; color: rgba(255,255,255,0.4); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 24px; }

    .modal-btns { display: flex; gap: 10px; }

    /* â”€â”€â”€ TOAST â”€â”€â”€ */
    #toast-area {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 900;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      background: linear-gradient(135deg, var(--green), var(--neon));
      color: var(--c0);
      padding: 12px 20px;
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 5px 20px rgba(0,243,255,0.4);
      animation: toastIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      pointer-events: none;
    }

    .toast.out { animation: toastOut 0.4s ease-in forwards; }

    @keyframes toastIn {
      from { transform: translateX(120px); opacity: 0; }
      to   { transform: translateX(0); opacity: 1; }
    }

    @keyframes toastOut {
      from { transform: translateX(0); opacity: 1; }
      to   { transform: translateX(120px); opacity: 0; }
    }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
    @media (max-width: 480px) {
      .wrapper { padding: 14px 10px 30px; }
      .logo-area h1 { font-size: 2rem; }
      .stat { min-width: 68px; padding: 8px 10px; }
      .stat-value { font-size: 1.2rem; }
      .ach-grid { grid-template-columns: repeat(4, 1fr); }
      .session-stats { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 350px) {
      .logo-area h1 { font-size: 1.6rem; }
      .ach-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (min-width: 900px) {
      .wrapper { transform: scale(1.05); transform-origin: top center; }
    }

    /* Zen mode indicator */
    body.zen-mode {
      --neon: #00ff9d;
      --border: rgba(0,255,157,0.15);
    }

    body.zen-mode .logo-area h1 {
      background: linear-gradient(120deg, var(--green) 0%, #00ccff 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }

    /* Scanline flicker on extreme mode */
    body.extreme-mode #game-board {
      animation: boardFlicker 4s linear infinite;
    }

    @keyframes boardFlicker {
      0%,100% { opacity: 1; }
      97% { opacity: 1; }
      97.5% { opacity: 0.85; }
      98% { opacity: 1; }
    }
  </style>
</head>
<body>

<canvas id="particles"></canvas>
<div id="toast-area"></div>

<!-- Timer -->
<div id="timer-pill">
  <i class="fas fa-clock"></i>
  <span id="timer-text">03:00</span>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <div class="modal-icon" id="modal-icon">ğŸ†</div>
    <div class="modal-title" id="modal-title">VITÃ“RIA!</div>
    <div class="modal-score" id="modal-score">0</div>
    <div class="modal-score-label">PONTOS</div>
    <div class="modal-msg" id="modal-msg"></div>
    <div class="modal-btns">
      <button class="btn btn-cyan" id="btn-restart-modal" style="flex:1">
        <i class="fas fa-redo"></i> Novo Jogo
      </button>
      <button class="btn btn-magenta" id="btn-continue-modal" style="flex:1;display:none">
        <i class="fas fa-play"></i> Continuar
      </button>
    </div>
  </div>
</div>

<!-- Main -->
<div class="wrapper">

  <!-- Header -->
  <div class="header">
    <div class="logo-area">
      <h1>2048</h1>
      <div class="ver">NEXUS Â· V2.0</div>
    </div>
    <div class="stats-row">
      <div class="stat">
        <div class="stat-label">Score</div>
        <div class="stat-value" id="score">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Melhor</div>
        <div class="stat-value" id="best">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">Moves</div>
        <div class="stat-value" id="moves">0</div>
      </div>
    </div>
  </div>

  <!-- Combo banner -->
  <div id="combo-banner">
    <span class="combo-flame">ğŸ”¥</span>
    <span id="combo-text">COMBO Ã—2</span>
    <span class="combo-flame">ğŸ”¥</span>
  </div>

  <!-- Selectors -->
  <div class="selectors">
    <div class="sel-group" id="size-btns">
      <button class="chip active" data-size="4">4Ã—4</button>
      <button class="chip" data-size="5">5Ã—5</button>
    </div>
    <div class="sel-group" id="mode-btns">
      <button class="chip active" data-mode="classic">ClÃ¡ssico</button>
      <button class="chip mode-time" data-mode="time">â± Tempo</button>
      <button class="chip mode-extreme" data-mode="extreme">ğŸ’€ Extremo</button>
      <button class="chip mode-zen" data-mode="zen">ğŸŒ¿ Zen</button>
    </div>
  </div>

  <!-- Board -->
  <div class="board-wrapper">
    <div id="game-board" class="board-4"></div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button class="btn btn-cyan" id="btn-undo" disabled>
      <i class="fas fa-undo"></i> Desfazer
    </button>
    <button class="btn btn-magenta" id="btn-restart">
      <i class="fas fa-redo-alt"></i> Reiniciar
    </button>
  </div>

  <!-- Session stats -->
  <div class="panel">
    <div class="panel-title"><i class="fas fa-chart-bar"></i> SessÃ£o Atual</div>
    <div class="session-stats">
      <div class="ss-item">
        <div class="ss-val" id="ss-tile">â€“</div>
        <div class="ss-label">Maior Tile</div>
      </div>
      <div class="ss-item">
        <div class="ss-val" id="ss-combo">0</div>
        <div class="ss-label">Melhor Combo</div>
      </div>
      <div class="ss-item">
        <div class="ss-val" id="ss-eff">â€“</div>
        <div class="ss-label">EficiÃªncia</div>
      </div>
    </div>
  </div>

  <!-- Conquistas -->
  <div class="panel">
    <div class="panel-title"><i class="fas fa-trophy"></i> Conquistas</div>
    <div class="ach-grid">
      <div class="ach-item" data-ach="first-win">
        <div class="ach-icon">ğŸ¯</div>
        <div class="ach-name">Primeira VitÃ³ria</div>
      </div>
      <div class="ach-item" data-ach="speed-demon">
        <div class="ach-icon">âš¡</div>
        <div class="ach-name">Veloz</div>
      </div>
      <div class="ach-item" data-ach="combo-master">
        <div class="ach-icon">ğŸ”¥</div>
        <div class="ach-name">Combo Ã—5</div>
      </div>
      <div class="ach-item" data-ach="high-scorer">
        <div class="ach-icon">ğŸ’</div>
        <div class="ach-name">10k Pts</div>
      </div>
      <div class="ach-item" data-ach="precision">
        <div class="ach-icon">ğŸ²</div>
        <div class="ach-name">PrecisÃ£o</div>
      </div>
      <div class="ach-item" data-ach="survivor">
        <div class="ach-icon">ğŸ›¡ï¸</div>
        <div class="ach-name">Sobrevivente</div>
      </div>
      <div class="ach-item" data-ach="4096-club">
        <div class="ach-icon">ğŸŒŒ</div>
        <div class="ach-name">Clube 4096</div>
      </div>
      <div class="ach-item" data-ach="5x5-master">
        <div class="ach-icon">ğŸ…</div>
        <div class="ach-name">Mestre 5Ã—5</div>
      </div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div class="panel">
    <div class="panel-title"><i class="fas fa-star"></i> Top Recordes</div>
    <div class="lb-list" id="lb-list"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   2048 NEXUS v2.0 â€” Engine & UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Particles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
const particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Particle {
  constructor(x, y, color) {
    this.x = x; this.y = y;
    this.color = color;
    this.r = Math.random() * 4 + 2;
    this.vx = (Math.random() - 0.5) * 5;
    this.vy = (Math.random() - 0.5) * 5 - 2;
    this.life = 1;
    this.decay = Math.random() * 0.03 + 0.02;
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += 0.12;
    this.life -= this.decay;
  }
  draw() {
    ctx.save();
    ctx.globalAlpha = this.life;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.shadowBlur = 8;
    ctx.shadowColor = this.color;
    ctx.fill();
    ctx.restore();
  }
}

function spawnParticles(x, y, color, count = 16) {
  for (let i = 0; i < count; i++) particles.push(new Particle(x, y, color));
}

function animParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update();
    particles[i].draw();
    if (particles[i].life <= 0) particles.splice(i, 1);
  }
  requestAnimationFrame(animParticles);
}
animParticles();

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let bSize = 4;
let board = [];
let score = 0, moves = 0;
let gameMode = 'classic';
let gameActive = true, hasWon = false;
let prevState = null;
let timerRef = null, timeLeft = 180;
let comboCount = 0, bestCombo = 0, highestTile = 0;
let lastMergeTime = 0;
const COMBO_WINDOW = 800; // ms

let achievements = JSON.parse(localStorage.getItem('2048-nexus-ach-v2')) || {};
let leaderboard  = JSON.parse(localStorage.getItem('2048-nexus-lb-v2'))  || [];
let bestScore    = parseInt(localStorage.getItem('2048-nexus-best-v2')) || 0;

// â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const gameBoard     = document.getElementById('game-board');
const scoreEl       = document.getElementById('score');
const bestEl        = document.getElementById('best');
const movesEl       = document.getElementById('moves');
const timerPill     = document.getElementById('timer-pill');
const timerText     = document.getElementById('timer-text');
const comboBanner   = document.getElementById('combo-banner');
const comboTextEl   = document.getElementById('combo-text');
const modal         = document.getElementById('modal');
const modalIcon     = document.getElementById('modal-icon');
const modalTitle    = document.getElementById('modal-title');
const modalScore    = document.getElementById('modal-score');
const modalMsg      = document.getElementById('modal-msg');
const btnContinue   = document.getElementById('btn-continue-modal');
const btnRestartM   = document.getElementById('btn-restart-modal');
const btnUndo       = document.getElementById('btn-undo');
const btnRestart    = document.getElementById('btn-restart');
const ssTile        = document.getElementById('ss-tile');
const ssCombo       = document.getElementById('ss-combo');
const ssEff         = document.getElementById('ss-eff');
const lbList        = document.getElementById('lb-list');

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initGame() {
  board = Array(bSize).fill(null).map(() => Array(bSize).fill(0));
  score = 0; moves = 0;
  gameActive = true; hasWon = false;
  prevState = null;
  comboCount = 0; bestCombo = 0; highestTile = 0;

  if (timerRef) clearInterval(timerRef);
  timerPill.classList.remove('active', 'urgent');
  timerPill.classList.toggle('active', gameMode === 'time');

  if (gameMode === 'time') {
    timeLeft = 180;
    updateTimerDisplay();
    startTimer();
  }

  addTile(); addTile();
  renderBoard(false);
  updateStats();
  updateSession();
  modal.classList.remove('show');
  comboBanner.classList.remove('show');

  document.body.classList.toggle('zen-mode', gameMode === 'zen');
  document.body.classList.toggle('extreme-mode', gameMode === 'extreme');

  gameBoard.className = `board-${bSize}`;
}

function startTimer() {
  timerRef = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 30) timerPill.classList.add('urgent');
    if (timeLeft <= 0) {
      clearInterval(timerRef);
      endGame(false, 'O tempo acabou!');
    }
  }, 1000);
}

function updateTimerDisplay() {
  const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
  const s = (timeLeft % 60).toString().padStart(2, '0');
  timerText.textContent = `${m}:${s}`;
}

// â”€â”€ Tile spawn â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addTile() {
  const empty = [];
  board.forEach((row, r) => row.forEach((v, c) => { if (!v) empty.push({r, c}); }));
  if (!empty.length) return;
  const {r, c} = empty[Math.floor(Math.random() * empty.length)];
  board[r][c] = gameMode === 'extreme'
    ? 4
    : (Math.random() < 0.1 ? 4 : 2);
  return {r, c};
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lastBoard = [];
let mergedCells = [];
let newCells = [];

function renderBoard(animated = true) {
  const frag = document.createDocumentFragment();
  board.forEach((row, r) => {
    row.forEach((v, c) => {
      const tile = document.createElement('div');
      tile.className = 'tile';
      if (v > 0) {
        tile.textContent = v;
        tile.setAttribute('data-v', v);
        const isMerge = animated && mergedCells.some(m => m.r === r && m.c === c);
        const isNew   = animated && newCells.some(n => n.r === r && n.c === c);
        if (isMerge) tile.classList.add('merged');
        else if (isNew) tile.classList.add('filled');
        else tile.classList.add('filled');
      }
      frag.appendChild(tile);
    });
  });
  gameBoard.innerHTML = '';
  gameBoard.appendChild(frag);
}

function updateStats() {
  const prev = parseInt(scoreEl.textContent) || 0;
  scoreEl.textContent = score;
  movesEl.textContent = moves;
  bestEl.textContent  = bestScore;

  if (score > prev && prev > 0) {
    scoreEl.classList.remove('pulse-up');
    void scoreEl.offsetWidth;
    scoreEl.classList.add('pulse-up');
  }

  btnUndo.disabled = !prevState;
}

function updateSession() {
  const tile = highestTile || 'â€“';
  ssTile.textContent = tile;
  ssCombo.textContent = bestCombo;
  const eff = moves > 0 ? Math.round(score / moves) : 0;
  ssEff.textContent = moves > 0 ? eff : 'â€“';
}

// â”€â”€ Move logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let isMoving = false;

function handleMove(dir) {
  if (!gameActive || isMoving) return;
  isMoving = true;

  const snap = JSON.stringify(board);
  saveState();

  mergedCells = [];
  let merged = false;

  if (dir === 'left')  { board = board.map(r => combineRow(r));                          }
  if (dir === 'right') { board = board.map(r => combineRow([...r].reverse()).reverse()); }
  if (dir === 'up')    { board = rotateBoard(board, false); board = board.map(r => combineRow(r)); board = rotateBoard(board, true); }
  if (dir === 'down')  { board = rotateBoard(board, true);  board = board.map(r => combineRow(r)); board = rotateBoard(board, false); }

  if (JSON.stringify(board) !== snap) {
    moves++;

    // Combo logic
    const now = Date.now();
    if (mergedCells.length > 0) {
      if (now - lastMergeTime < COMBO_WINDOW) {
        comboCount++;
      } else {
        comboCount = 1;
      }
      lastMergeTime = now;
      if (comboCount > bestCombo) bestCombo = comboCount;
      showCombo(comboCount);
    } else {
      comboCount = 0;
      comboBanner.classList.remove('show');
    }

    // Particle effect on merges
    if (mergedCells.length > 0) {
      const rect = gameBoard.getBoundingClientRect();
      const cellW = rect.width / bSize;
      mergedCells.forEach(({r, c, v}) => {
        const px = rect.left + c * cellW + cellW / 2;
        const py = rect.top  + r * cellW + cellW / 2;
        const color = getTileColor(v);
        spawnParticles(px, py, color, 12 + comboCount * 3);
      });
    }

    newCells = [];
    const newT = addTile();
    if (newT) newCells = [newT];

    renderBoard(true);
    updateStats();
    updateSession();
    checkGameStatus();
    checkAchievements();
  } else {
    prevState = null;
  }

  setTimeout(() => { isMoving = false; }, 100);
}

function combineRow(row) {
  let r = row.filter(v => v > 0);
  for (let i = 0; i < r.length - 1; i++) {
    if (r[i] === r[i + 1]) {
      r[i] *= 2;
      score += r[i] * (1 + Math.floor(comboCount / 2) * 0.5);
      score = Math.floor(score);
      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem('2048-nexus-best-v2', bestScore);
      }
      // Track which cell got merged (approximate row position)
      mergedCells.push({r: -1, c: -1, v: r[i]});
      r[i + 1] = 0;
    }
  }
  r = r.filter(v => v > 0);
  while (r.length < bSize) r.push(0);
  return r;
}

// Track exact merge positions
function handleMoveWithPositions(dir) {
  // We'll track merges per row/col during combineRowTracked
  if (!gameActive || isMoving) return;
  isMoving = true;

  const snap = JSON.stringify(board);
  saveState();
  mergedCells = [];

  const combineRowTracked = (row, rowIdx, colOffset = 0, transpose = false) => {
    let r = row.map((v, i) => ({v, orig: i})).filter(x => x.v > 0);
    for (let i = 0; i < r.length - 1; i++) {
      if (r[i].v === r[i + 1].v) {
        r[i].v *= 2;
        score += r[i].v * Math.max(1, 1 + (comboCount - 1) * 0.5);
        score = Math.floor(score);
        if (score > bestScore) {
          bestScore = score;
          localStorage.setItem('2048-nexus-best-v2', bestScore);
        }
        if (r[i].v > highestTile) highestTile = r[i].v;

        const finalPos = i + colOffset;
        if (!transpose) mergedCells.push({r: rowIdx, c: finalPos, v: r[i].v});
        else            mergedCells.push({r: finalPos, c: rowIdx, v: r[i].v});

        r[i + 1].v = 0;
      }
    }
    r = r.filter(x => x.v > 0).map(x => x.v);
    while (r.length < bSize) r.push(0);
    return r;
  };

  if (dir === 'left') {
    board = board.map((row, ri) => combineRowTracked(row, ri));
  } else if (dir === 'right') {
    board = board.map((row, ri) => {
      const rev = combineRowTracked([...row].reverse(), ri, 0);
      const result = rev.reverse();
      // fix merge cell columns
      mergedCells = mergedCells.map(m => m.r === ri ? {...m, c: bSize - 1 - m.c} : m);
      return result;
    });
  } else if (dir === 'up') {
    const transposed = transpose(board);
    const newT = transposed.map((row, ri) => combineRowTracked(row, ri, 0, true));
    board = transpose(newT);
  } else if (dir === 'down') {
    const transposed = transpose(board);
    const flipped = transposed.map(r => [...r].reverse());
    const combined = flipped.map((row, ri) => combineRowTracked(row, ri, 0, true));
    const reflipped = combined.map(r => r.reverse());
    board = transpose(reflipped);
    mergedCells = mergedCells.map(m => ({...m, r: bSize - 1 - m.r}));
  }

  if (JSON.stringify(board) !== snap) {
    moves++;

    const now = Date.now();
    if (mergedCells.length > 0) {
      if (now - lastMergeTime < COMBO_WINDOW) comboCount++;
      else comboCount = 1;
      lastMergeTime = now;
      if (comboCount > bestCombo) bestCombo = comboCount;
      showCombo(comboCount);

      const rect = gameBoard.getBoundingClientRect();
      const cellW = rect.width / bSize;
      mergedCells.forEach(({r, c, v}) => {
        if (r >= 0 && c >= 0) {
          const px = rect.left + c * cellW + cellW / 2;
          const py = rect.top  + r * cellW + cellW / 2;
          spawnParticles(px, py, getTileColor(v), 10 + Math.min(comboCount, 8) * 2);
        }
      });
    } else {
      comboCount = 0;
      comboBanner.classList.remove('show');
    }

    newCells = [];
    const newT = addTile();
    if (newT) newCells = [newT];

    renderBoard(true);
    updateStats();
    updateSession();
    checkGameStatus();
    checkAchievements();
  } else {
    prevState = null;
  }

  setTimeout(() => { isMoving = false; }, 120);
}

function transpose(m) {
  return m[0].map((_, ci) => m.map(row => row[ci]));
}

function rotateBoard(b, cw) {
  const n = b.length;
  const nb = Array(n).fill(null).map(() => Array(n).fill(0));
  for (let r = 0; r < n; r++)
    for (let c = 0; c < n; c++)
      if (cw) nb[c][n - 1 - r] = b[r][c];
      else    nb[n - 1 - c][r] = b[r][c];
  return nb;
}

// â”€â”€ Save/undo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveState() {
  prevState = {
    board: JSON.parse(JSON.stringify(board)),
    score, moves, comboCount, highestTile, bestCombo
  };
}

function undo() {
  if (!prevState) return;
  board = JSON.parse(JSON.stringify(prevState.board));
  score = prevState.score;
  moves = prevState.moves;
  comboCount   = prevState.comboCount;
  highestTile  = prevState.highestTile;
  bestCombo    = prevState.bestCombo;
  prevState = null;
  mergedCells = []; newCells = [];
  renderBoard(false);
  updateStats();
  updateSession();
}

// â”€â”€ Combo UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let comboTimeout = null;
function showCombo(n) {
  if (n < 2) { comboBanner.classList.remove('show'); return; }
  comboTextEl.textContent = `COMBO Ã—${n}`;
  comboBanner.classList.remove('show');
  void comboBanner.offsetWidth;
  comboBanner.classList.add('show');
  if (comboTimeout) clearTimeout(comboTimeout);
  comboTimeout = setTimeout(() => comboBanner.classList.remove('show'), 1200);
}

// â”€â”€ Game status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkGameStatus() {
  let max = 0;
  board.forEach(row => row.forEach(v => { if (v > max) max = v; }));
  highestTile = Math.max(highestTile, max);

  if (max >= 2048 && !hasWon && gameMode !== 'zen') {
    hasWon = true;
    unlockAch('first-win');
    setTimeout(() => endGame(true, `VocÃª chegou ao 2048! ğŸ‰`), 300);
    return;
  }

  if (max >= 4096) unlockAch('4096-club');

  if (gameMode !== 'zen' && !hasMoves()) {
    setTimeout(() => endGame(false, `Sem movimentos disponÃ­veis.`), 200);
  }
}

function hasMoves() {
  for (let r = 0; r < bSize; r++)
    for (let c = 0; c < bSize; c++) {
      if (!board[r][c]) return true;
      if (c < bSize - 1 && board[r][c] === board[r][c + 1]) return true;
      if (r < bSize - 1 && board[r][c] === board[r + 1][c]) return true;
    }
  return false;
}

function endGame(win, msg) {
  if (!gameActive) return;
  if (gameMode === 'zen') return;
  gameActive = false;
  if (timerRef) clearInterval(timerRef);

  // Save to leaderboard
  if (score > 0) {
    leaderboard.push({
      score,
      mode: gameMode,
      size: `${bSize}Ã—${bSize}`,
      date: new Date().toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'})
    });
    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem('2048-nexus-lb-v2', JSON.stringify(leaderboard));
    renderLeaderboard();
  }

  modalIcon.textContent  = win ? 'ğŸ†' : 'ğŸ’€';
  modalTitle.textContent = win ? 'VITÃ“RIA!' : 'FIM DE JOGO';
  modalTitle.className   = `modal-title ${win ? 'win' : 'lose'}`;
  modalScore.textContent = score.toLocaleString();
  modalMsg.textContent   = `${msg} ${moves} jogadas Â· Melhor tile: ${highestTile}`;
  btnContinue.style.display = win ? 'flex' : 'none';
  modal.classList.add('show');
}

// â”€â”€ Achievements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkAchievements() {
  if (hasWon) unlockAch('first-win');
  if (gameMode === 'time' && score >= 1500 && !achievements['speed-demon']) unlockAch('speed-demon');
  if (bestCombo >= 5) unlockAch('combo-master');
  if (score >= 10000) unlockAch('high-scorer');
  if (moves <= 80 && score >= 2048) unlockAch('precision');
  if (bSize === 4 && moves >= 300) unlockAch('survivor');
  if (bSize === 5 && hasWon) unlockAch('5x5-master');
}

function unlockAch(id) {
  if (achievements[id]) return;
  achievements[id] = true;
  localStorage.setItem('2048-nexus-ach-v2', JSON.stringify(achievements));
  const el = document.querySelector(`[data-ach="${id}"]`);
  if (el) el.classList.add('unlocked');
  const name = el ? el.querySelector('.ach-name').textContent : id;
  showToast(`ğŸ† Conquista: ${name}`);
}

function loadAchievements() {
  Object.keys(achievements).forEach(id => {
    const el = document.querySelector(`[data-ach="${id}"]`);
    if (el) el.classList.add('unlocked');
  });
}

// â”€â”€ Leaderboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLeaderboard() {
  lbList.innerHTML = '';
  if (!leaderboard.length) {
    lbList.innerHTML = '<div style="color:rgba(255,255,255,0.3);font-size:0.85rem;text-align:center;padding:12px">Nenhum recorde ainda.</div>';
    return;
  }
  leaderboard.forEach((entry, i) => {
    const row = document.createElement('div');
    row.className = 'lb-row';
    row.innerHTML = `
      <div class="lb-rank">${i === 0 ? 'ğŸ‘‘' : i + 1}</div>
      <div class="lb-score">${entry.score.toLocaleString()}</div>
      <div class="lb-meta">${entry.size} Â· ${entry.mode} Â· ${entry.date}</div>
    `;
    lbList.appendChild(row);
  });
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const area = document.getElementById('toast-area');
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  area.appendChild(t);
  setTimeout(() => {
    t.classList.add('out');
    setTimeout(() => t.remove(), 500);
  }, 2800);
}

// â”€â”€ Tile color helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getTileColor(v) {
  const map = {
    2:'#a8d8ff', 4:'#7ec8ff', 8:'#55b8ff', 16:'#00f3ff',
    32:'#ff80ff', 64:'#ff55ff', 128:'#ff33dd', 256:'#ffcc55',
    512:'#ffbb00', 1024:'#66ffcc', 2048:'#00ffaa', 4096:'#cc66ff', 8192:'#ff6666'
  };
  return map[v] || '#ffffff';
}

// â”€â”€ Event Listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  const map = { ArrowUp:'up', ArrowDown:'down', ArrowLeft:'left', ArrowRight:'right' };
  if (map[e.key]) { e.preventDefault(); handleMoveWithPositions(map[e.key]); }
  if ((e.ctrlKey || e.metaKey) && e.key === 'z') { e.preventDefault(); undo(); }
});

// Touch
let tx = 0, ty = 0;
document.addEventListener('touchstart', e => {
  if (!gameActive) return;
  tx = e.touches[0].clientX;
  ty = e.touches[0].clientY;
}, { passive: true });

document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });

document.addEventListener('touchend', e => {
  if (!gameActive) return;
  const dx = e.changedTouches[0].clientX - tx;
  const dy = e.changedTouches[0].clientY - ty;
  if (Math.max(Math.abs(dx), Math.abs(dy)) < 18) return;
  if (Math.abs(dx) > Math.abs(dy)) handleMoveWithPositions(dx > 0 ? 'right' : 'left');
  else handleMoveWithPositions(dy > 0 ? 'down' : 'up');
});

// Mouse swipe
let mx = 0, my = 0, mdown = false;
gameBoard.addEventListener('mousedown', e => {
  if (!gameActive) return;
  mx = e.clientX; my = e.clientY; mdown = true;
});
document.addEventListener('mouseup', e => {
  if (!mdown) return;
  mdown = false;
  const dx = e.clientX - mx, dy = e.clientY - my;
  if (Math.max(Math.abs(dx), Math.abs(dy)) < 18) return;
  if (Math.abs(dx) > Math.abs(dy)) handleMoveWithPositions(dx > 0 ? 'right' : 'left');
  else handleMoveWithPositions(dy > 0 ? 'down' : 'up');
});

// Buttons
btnRestart.addEventListener('click', initGame);
btnUndo.addEventListener('click', undo);
btnRestartM.addEventListener('click', initGame);
btnContinue.addEventListener('click', () => {
  modal.classList.remove('show');
  gameActive = true;
});

// Size chips
document.getElementById('size-btns').addEventListener('click', e => {
  const chip = e.target.closest('.chip');
  if (!chip) return;
  document.querySelectorAll('#size-btns .chip').forEach(c => c.classList.remove('active'));
  chip.classList.add('active');
  bSize = parseInt(chip.dataset.size);
  initGame();
});

// Mode chips
document.getElementById('mode-btns').addEventListener('click', e => {
  const chip = e.target.closest('.chip');
  if (!chip) return;
  document.querySelectorAll('#mode-btns .chip').forEach(c => c.classList.remove('active'));
  chip.classList.add('active');
  gameMode = chip.dataset.mode;

  const msgs = {
    classic: 'â™Ÿ Modo ClÃ¡ssico!',
    time: 'â± Modo Contra o Tempo â€” 3 minutos!',
    extreme: 'ğŸ’€ Modo Extremo â€” apenas tiles 4!',
    zen: 'ğŸŒ¿ Modo Zen â€” sem game over, relaxe!'
  };
  showToast(msgs[gameMode]);
  initGame();
});

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadAchievements();
renderLeaderboard();
bestEl.textContent = bestScore;
initGame();
</script>
</body>
</html>
